# ETF网格交易分析系统设计文档

## 1. 系统概述

### 1.1 设计目标
- 分析ETF历史数据，为网格交易提供参数建议
- 对比网格交易与直接持仓的收益和风险
- 提供不同时间周期的策略分析
- 生成综合评分和参数推荐

### 1.2 核心功能
- ETF历史数据分析
- 网格交易参数优化
- 多周期回测对比
- 策略评分与推荐

## 2. 数据分析设计

### 2.1 时间周期划分
- 短期：1个月交易日数据
- 中期：6个月交易日数据
- 长期：1年交易日数据

### 2.2 分析指标
1. 收益指标
   - 总收益率
   - 年化收益率
   - 单次交易平均收益
   - 资金利用率

2. 风险指标
   - 最大回撤
   - 波动率（日度、周度、月度）
   - ATR指标
   - 夏普比率
   - 交易胜率

3. 操作指标
   - 交易次数
   - 平均持仓时间
   - 网格触发频率
   - 每格资金利用率

### 2.3 网格参数计算
1. 波动预判机制
   - 历史波动分析
     * 计算过去N日的波动率均值作为基准
     * 使用GARCH模型预测未来波动率
     * 结合历史高低点分布特征
   
   - 基础技术指标分析
     * 价格趋势（MA）
     * 成交量
     * RSI超买超卖

2. 动态调整机制
   - 实时监控
     * 跟踪预测波动率与实际波动率的偏差
     * 当偏差超过阈值时触发调整
   
   - 调整方式
     * 网格间距动态调整
     * 交易量动态调整
     * 触发条件动态调整

3. 风险控制
   - 上涨风险控制
     * 设置保留仓位比例（如20%）永远不卖出
     * 超过网格上限后改为跟踪止盈模式
     * 可选择自动扩展上方网格范围

   - 下跌风险控制
     * 预留额外资金池（建议20%总资金）
     * 超过网格下限后采用定投模式
     * 可设置止损线，触发后暂停网格交易
   
   - 动态调整机制
     * 当价格接近网格边界时预警
     * 提供网格范围自动扩展选项
     * 允许追加资金或调整网格参数

4. 资金配置优化
   - 资金分配建议
     * 底仓资金：40%
     * 网格交易资金：40%
     * 预留资金：20%
   
   - 预留资金用途
     * 应对过度下跌的补仓需求
     * 处理网格范围扩展情况
     * 把握超出网格范围的交易机会

1. 网格触发点计算
   - 基于技术指标计算单格涨跌幅
     * 波动率分析（日度、周度、月度）
     * ATR指标（考虑不同周期）
     * 趋势指标（辅助判断）
   - 不同周期的触发点调整
     * 短期：使用较小的涨跌幅（更频繁交易）
     * 中期：使用中等涨跌幅
     * 长期：使用较大涨跌幅（降低交易频率）

2. 资金配置计算
   - 资金分配原则
     * 总资金分为两部分：底仓资金和补仓资金，各占50%
     * 底仓资金 = 总资金 × 50%
     * 补仓资金 = 总资金 × 50%
   
   - 具体计算
     * 每格投入资金 = 补仓资金 ÷ 网格数
     * 底仓购买数量 = 底仓资金 ÷ 当前价格
     * 每格交易数量 = 每格投入资金 ÷ 当前价格
     * 确保每格交易数量为100的整数倍

3. 实际案例（以10万资金为例）
   - 资金分配：
     * 底仓资金 = 5万元
     * 补仓资金 = 5万元
   - 若设置10格：
     * 每格投入资金 = 5万 ÷ 10 = 5000元
   - 交易规则：
     * 上涨一格：卖出一份网格资金的持仓
     * 下跌一格：买入一份网格资金的标的

1. 基础参数
   - 根据时间周期确定基准波动率
     * 短期(1月)：使用日波动率
     * 中期(6月)：使用周波动率
     * 长期(1年)：使用月波动率

2. 网格参数设置
   - 参数输入：
     * 网格数量：决定资金分配（如10格）
     * ATR倍数：决定网格间距（如1.0倍ATR）
   
   - ATR说明：
     * ATR反映ETF的日常波动幅度
     * 如ETF的ATR=0.15，选择1.0倍ATR
     * 则每个网格间距为0.15元
     * 价格每涨跌0.15元触发一次交易

   - 参数组合建议：
     * 保守策略：10格 + 1.5倍ATR
     * 平衡策略：10格 + 1.0倍ATR
     * 激进策略：10格 + 0.5倍ATR

   - 参数验证：
     * 确保每格交易量满足最小单位（100股）
     * 验证资金在当前价位的覆盖范围

2. 网格数量推荐
   - 基于波动率和ATR动态计算
   - 考虑资金利用率（每格至少能买100股）
   - 不同周期的推荐范围：
     * 短期：8-12格
     * 中期：12-16格
     * 长期：15-20格

3. 网格区间计算
   - 使用ATR确定合理的网格间距
   - 考虑历史波动范围
   - 结合资金利用效率

### 2.3 评分维度
1. 收益得分（30分）
   - 总收益率（15分）
   - 年化收益率（10分）
   - 资金利用率（5分）

2. 风险控制（25分）
   - 最大回撤（10分）
   - 波动率（8分）
   - 夏普比率（7分）

3. 操作难度（15分）
   - 交易频率（8分）
   - 资金需求（7分）

4. 稳定性（15分）
   - 胜率（8分）
   - 收益波动（7分）

5. 适应性（15分）
   - 不同市场环境表现（8分）
   - 参数敏感度（7分）

## 3. 数据库设计
### 3.1 网格交易数据表
    CREATE TABLE grid_trade (
        etf_code VARCHAR(10),
        date DATE,
        open_price REAL,
        close_price REAL,
        low_price REAL,
        high_price REAL,
        volume REAL,
        money REAL,
        factor REAL,
        high_limit REAL,
        low_limit REAL,
        avg_price REAL,
        pre_close REAL,
        paused REAL,
        PRIMARY KEY (etf_code, date)
    )

### 3.2 网格回测结果表
    CREATE TABLE grid_backtest_results (
        etf_code VARCHAR(10),
        period_type VARCHAR(10),  -- short/medium/long
        start_date DATE,
        end_date DATE,
        grid_params JSON,        -- 存储网格参数
        backtest_result JSON,    -- 存储回测结果
        score JSON,              -- 存储评分结果
        PRIMARY KEY (etf_code, period_type, start_date, end_date)
    )

### 3.2 参数推荐表

    CREATE TABLE grid_params_recommend (
        etf_code VARCHAR(10),
        period_type VARCHAR(10),
        calc_date DATE,
        recommend_params JSON,  -- 存储推荐的网格参数
        analysis_result JSON,   -- 存储分析结果
        PRIMARY KEY (etf_code, period_type, calc_date)
    )

## 4. 页面设计
### 4.1 页面布局
1. 上部分：参数设置区
   - ETF选择下拉框
   - 时间周期选择（短期/中期/长期）
   - 网格参数设置（区间、数量）
   - 初始资金显示（固定10万）
   - 分析按钮

2. 中部分：图表展示区
   - 左侧：价格走势图
     * 显示网格线
     * 显示买卖点
   - 右侧：分析评分雷达图

3. 下部分：分析结果区
   - 网格交易 vs 直接持仓对比
   - 各项指标数据表格
   - 参数推荐说明

### 4.2 交互设计
1. ETF选择
   - 下拉选择ETF
   - 自动加载历史数据

2. 参数设置
   - 时间周期选择
   - 网格参数输入
   - 参数合理性验证

3. 分析结果展示
   - 实时更新图表
   - 动态计算评分
   - 参数推荐提示

## 5. 技术实现

### 5.1 前端实现
- 使用jQuery构建交互逻辑
- Bootstrap构建响应式界面
- ECharts绘制图表
- Element UI组件库

### 5.2 后端实现
- Flask提供API服务
- pandas进行数据分析
- SQLite存储数据

### 5.3 核心算法
1. 网格参数计算
   - 基于波动率的区间计算
   - 基于ATR的网格间距优化
   - 考虑交易成本的网格数量确定

2. 回测模拟
   - 模拟网格交易过程
   - 计算各项指标
   - 生成交易记录

3. 评分系统
   - 多维度指标归一化
   - 加权计算总分
   - 生成推荐建议

## 6. 注意事项
1. 数据完整性验证
2. 参数合理性检查
3. 计算性能优化
4. 结果可靠性验证



